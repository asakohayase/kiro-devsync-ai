# Deployment Guide for DevSync AI

## Deploy to Render

### Prerequisites
1. GitHub account with your code pushed
2. GitHub Personal Access Token
3. Render account (free tier available)

### Steps

1. **Push your code to GitHub** (if not already done):
   ```bash
   git add .
   git commit -m "Prepare for Render deployment"
   git push origin main
   ```

2. **Create Render Service**:
   - Go to [render.com](https://render.com)
   - Click "New +" → "Web Service"
   - Connect your GitHub repository: `asakohayase/kiro-devsync-ai`
   - Choose branch: `main`

3. **Configure Build Settings**:
   - **Name**: `devsync-ai`
   - **Environment**: `Python 3`
   - **Build Command**: `./render-build.sh` (custom script to handle uv conflicts)
   - **Start Command**: `uvicorn devsync_ai.main:app --host 0.0.0.0 --port $PORT`

4. **Set Environment Variables**:
   Go to Environment tab and add:
   ```
   DEBUG=false
   SECRET_KEY=<auto-generated>
   GITHUB_TOKEN=<your-github-token>
   GITHUB_WEBHOOK_SECRET=<your-webhook-secret>
   GITHUB_REPOSITORY=asakohayase/kiro-devsync-ai
   SUPABASE_URL=https://pbkmbvvqjjglvuoilbwu.supabase.co
   SUPABASE_KEY=<your-supabase-key>
   ```

5. **Deploy**:
   - Click "Create Web Service"
   - Wait for deployment (5-10 minutes)
   - Your app will be available at: `https://devsync-ai-<random>.onrender.com`

### After Deployment

1. **Test the API**:
   - Health check: `https://your-app.onrender.com/api/v1/health`
   - GitHub test: `https://your-app.onrender.com/api/v1/github/test`

2. **Set up GitHub Webhook** (optional):
   - Go to your GitHub repo → Settings → Webhooks → Add webhook
   - **Payload URL**: `https://your-app.onrender.com/webhooks/github`
   - **Content type**: `application/json`
   - **Secret**: Use the same secret you set in your environment variables
   - **Events**: Select "Let me select individual events" and choose:
     - ✅ Pull requests
     - ✅ Pull request reviews  
     - ✅ Push
     - ✅ Issues
     - ✅ Issue comments
     - ✅ Pull request review comments

### Troubleshooting

- **Build fails**: Check requirements.txt and Python version
- **"Shadowed commands" error**: Fixed with custom build script that removes conflicting uv installations
- **Build script fails**: Try fallback build command: `pip install --no-cache-dir --only-binary=cryptography,bcrypt,pydantic -r requirements.txt`
- **App crashes**: Check logs in Render dashboard
- **GitHub API fails**: Verify GITHUB_TOKEN is set correctly
- **Database issues**: Check SUPABASE_URL and SUPABASE_KEY
- **Build cache issues**: Try triggering a manual deploy to clear cache

### Alternative Build Commands (if build script fails)

If the custom build script doesn't work, try these alternatives in Render's build command field:

1. **Simple approach**: `pip install -r requirements.txt`
2. **With binary packages**: `pip install --only-binary=cryptography,bcrypt,pydantic -r requirements.txt`
3. **With PATH cleanup**: `export PATH=/usr/local/bin:/usr/bin:/bin && pip install -r requirements.txt`

### Free Tier Limitations

Render free tier:
- ✅ 750 hours/month (enough for testing)
- ⚠️ Sleeps after 15 minutes of inactivity
- ⚠️ Cold starts (30-60 seconds to wake up)
- ✅ Custom domain support
- ✅ Automatic HTTPS

For production, consider upgrading to paid tier ($7/month) for:
- No sleeping
- Faster cold starts
- More resources